<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>tinode series.002 - Install &amp; Run - 김영천 블로그</title>
  <meta property="og:title" content="tinode series.002 - Install &amp; Run - 김영천 블로그" />
  <meta name="twitter:title" content="tinode series.002 - Install &amp; Run - 김영천 블로그" />
  <meta name="description" content="서론  소스코드를 살펴보기에 앞서서 일단 프로그램 실행을 시켜보자. 이 글에서 설명하는 예제는 커밋 아이디 기준 2558db90a50c80c974c2fccfec6b87ea44e4758b을 바탕으로 설명한다. 사실 이 글을 안봐도 여기를 따라하면 보통을 무난하게 설치 및 실행을 할 수 있다. 이 가이드는 공식 가이드 중 Building from Source, Mysql을 기준으로 설명한다.
  실행환경 및 선행조건    Ubuntu 18.04 LTS
  Golang이 설치되어 있어야 한다(기준 버전 : 1.12.5).
  Mysql이 설치되어 있어야 한다(기준 버전: 5.">
  <meta property="og:description" content="서론  소스코드를 살펴보기에 앞서서 일단 프로그램 실행을 시켜보자. 이 글에서 설명하는 예제는 커밋 아이디 기준 2558db90a50c80c974c2fccfec6b87ea44e4758b을 바탕으로 설명한다. 사실 이 글을 안봐도 여기를 따라하면 보통을 무난하게 설치 및 실행을 할 수 있다. 이 가이드는 공식 가이드 중 Building from Source, Mysql을 기준으로 설명한다.
  실행환경 및 선행조건    Ubuntu 18.04 LTS
  Golang이 설치되어 있어야 한다(기준 버전 : 1.12.5).
  Mysql이 설치되어 있어야 한다(기준 버전: 5.">
  <meta name="twitter:description" content="서론  소스코드를 살펴보기에 앞서서 일단 프로그램 실행을 시켜보자. 이 글에서 설명하는 예제는 커밋 아이디 기준 2558db90a50c80c974c2fccfec6b87ea44e4758b을 바탕으로 설명한다. 사실 이 글을 안봐도 여기를 따라하면 보통을 무난하게 설치 및 실행을 할 수 있다. 이 가이드는 공식 가이드 중 Building from Source, …">
  <meta name="author" content="YeongCheon Kim"/>
  <meta property="og:site_name" content="김영천 블로그" />
  <meta property="og:url" content="https://yeongcheon.github.io/posts/2019-05-28-tinode002/" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://yeongcheon.github.io/images/profile.png" />
  <meta name="twitter:image" content="https://yeongcheon.github.io/images/profile.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.74.2" />


  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />

  <script src="/js/script.js"></script>
  <script src="/js/custom.js"></script>
  <script defer src="/js/fontawesome.js"></script>
</head>

<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="/">김영천 블로그</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-tags"><a href="/tags/" title="Tags">Tags</a></li>
      <li class="site-navi-item-archives"><a href="/posts/" title="Archives">Archives</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      
      
      <h1 class="article-title">tinode series.002 - Install &amp; Run</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>May 28, 2019</time></li>
        <li class="article-meta-tags">
          <a href="/tags/tinode/">
            <i class="fas fa-tag"></i>
            tinode
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/golang/">
            <i class="fas fa-tag"></i>
            golang
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/chat/">
            <i class="fas fa-tag"></i>
            chat
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/instant/">
            <i class="fas fa-tag"></i>
            &#34;instant
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/messaging/">
            <i class="fas fa-tag"></i>
            messaging&#34;
          </a>&nbsp;
        </li>
      </ul>
      
<aside class="toc">
  <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">서론</a>
</li>
<li><a href="#headline-2">실행환경 및 선행조건</a>
</li>
<li><a href="#headline-3">설치 및 실행하기</a>
<ul>
<li><a href="#headline-4">source 파일 내려받기 및 바이너리 파일 install</a>
</li>
<li><a href="#headline-5">데이터베이스 스키마 생성하기</a>
</li>
<li><a href="#headline-6">채팅서버 실행시키기</a>
</li>
</ul>
</li>
<li><a href="#headline-7">부록 - Go Modules를 이용해서 설치하기</a>
<ul>
<li><a href="#headline-8">Go modules 한방 스크립트</a>
</li>
</ul>
</li>
</ul>
</nav>
</aside>
      
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
서론
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>소스코드를 살펴보기에 앞서서 일단 프로그램 실행을 시켜보자. 이 글에서 설명하는 예제는 커밋 아이디 기준 <a href="https://github.com/YeongCheon/chat/commit/2558db90a50c80c974c2fccfec6b87ea44e4758b">2558db90a50c80c974c2fccfec6b87ea44e4758b</a>을 바탕으로 설명한다. 사실 이 글을 안봐도 <a href="https://github.com/tinode/chat/blob/master/INSTALL.md">여기</a>를 따라하면 보통을 무난하게 설치 및 실행을 할 수 있다. 이 가이드는 공식 가이드 중 <a href="https://github.com/tinode/chat/blob/master/INSTALL.md#building-from-source">Building from Source</a>, Mysql을 기준으로 설명한다.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
실행환경 및 선행조건
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<ul>
<li>
<p>Ubuntu 18.04 LTS</p>
</li>
<li>
<p>Golang이 설치되어 있어야 한다(기준 버전 : <code class="verbatim">1.12.5</code>).</p>
</li>
<li>
<p>Mysql이 설치되어 있어야 한다(기준 버전: <code class="verbatim">5.7</code>)</p>
</li>
</ul>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
설치 및 실행하기
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
source 파일 내려받기 및 바이너리 파일 install
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<p>다음 명령어를 입력한다.</p>
<div class="src src-shell">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">go get -tags mysql github.com/tinode/chat/server <span style="color:#f92672">&amp;&amp;</span> go install -tags mysql github.com/tinode/chat/server
go get -tags mysql github.com/tinode/chat/tinode-db <span style="color:#f92672">&amp;&amp;</span> go install -tags mysql github.com/tinode/chat/tinode-db</code></pre></td></tr></table>
</div>
</div>
</div>
<p>
첫번째 줄의 명령어는 실제로 동작하게 될 채팅서버와 연관된 소스코드를 다운로드 후 해당 소스코드를 컴파일하여 <code class="verbatim">$GOPATH/bin/</code> 경로에 <code class="verbatim">server</code> 라는 파일을 생성하는 명령어다.</p>
<p>
두번째 줄의 명령어는 데이터베이스 셋팅을 위한 소스코드를 다운로드 후 해당 소스코드를 컴파일하여 위와 마찬가지로 <code class="verbatim">$GOPATH/bin/</code> 경로에 <code class="verbatim">tinode-db</code> 라는 파일을 생성하는 명령어다.</p>
<p>
위의 명령어에서 눈여겨 볼 점은 <code class="verbatim">go get</code> 명령어와 <code class="verbatim">go install</code> 명령어 실행 시 모두 <code class="verbatim">-tags</code> 라는 옵션에 mysql이라는 값을 주었다는 점이다. <code class="verbatim">-tags</code> 옵션에 대한 자세한 설명은 <a href="https://golang.org/cmd/go/">공식문서</a> 또는 <a href="https://jacking75.github.io/go_build/">블로그 글</a>을 참고해보자.</p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
데이터베이스 스키마 생성하기
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>
MySQL에 데이터베이스 및 테이블을 생성하는 법을 알아보자.
우선 <code class="verbatim">$GOPATH/src/github.com/tinode/chat/tinode-db/tinode.conf</code> 파일을 열어서 db 접속정보가 올바른지 확인하자. 만약 접속정보와 다르다면(<del>당연히 대부분 다를거다</del>) 자신의 db 설정과 동일하게 고쳐주자. 다른부분은 건드릴 필요 없고 <code class="verbatim">store_config.adapters.mysql.dsn</code> 필드만 수정해주면 된다. 설정이 완료됐다면 아래의 명령어를 실행해주자.</p>
<div class="src src-shell">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$GOPATH/bin/tinode-db -config<span style="color:#f92672">=</span>$GOPATH/src/github.com/tinode/chat/tinode-db/tinode.conf</code></pre></td></tr></table>
</div>
</div>
</div>
<p>
이때 터미널의 위치는 가급적이면 <code class="verbatim">$GOPATH/src/github.com/tinode/chat</code> 로 이동시킨 후 실행시키자. conf 파일 중 상대경로 옵션이 적용되어 있는 경우가 있어서 다른 위치에서 명령어를 실행 시 에러를 발생시키기도 한다. 그리고 혹시 테스트용 더미 데이터를 추가하고 싶은 경우엔 위의 명령어 뒤에 = -data=$GOPATH/src/github.com/tinode/chat/tinode-db/data.json= 를 붙여주자. 당연히 필수는 아니다.</p>
<p>
명령어가 정상적으로 실행되었다면 터미널 창에 <strong>All done.</strong> 이라는 메세지가 뜬다.</p>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
채팅서버 실행시키기
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>
이제 마지막으로 실제 동작할 채팅서버를 실행시켜보자. 채팅서버를 실행하기에 앞서 우선 폴더 몇개를 복사해서 이동시켜야 한다.</p>
<ul>
<li>
<p><code class="verbatim">$GOPATH/src/tinode/chat/server/templ</code> 폴더를 복사해서 <code class="verbatim">$GOPATH/bin/</code> 아래에 붙여넣는다. 이 폴더에는 사용자에게 발송할 메일, sms 등의 템플릿이 담겨있다. 이 템플릿은 고 언어의 기본 패키지인 <a href="https://golang.org/pkg/html/template/">http/template</a> 패키지의 룰을 따른다.</p>
</li>
<li>
<p><code class="verbatim">$GOPATH/src/tinode/chat/server/uploads</code> 폴더를 복사해서 <code class="verbatim">$GOPATH/bin/</code> 아래에 붙여넣는다(<del>이건 사실 빈 폴더라서 굳이 복붙까진 필요없다.</del>).</p>
</li>
</ul>
<p>그리고 위에서 얘기한대로 터미널의 위치를 <code class="verbatim">$GOPATH/src/github.com/tinode/chat</code> 로 이동시킨 후 아래의 명령어를 실행해보자.</p>
<div class="src src-shell">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$GOPATH/bin/server -config<span style="color:#f92672">=</span>$GOPATH/src/github.com/tinode/chat/server/tinode.conf</code></pre></td></tr></table>
</div>
</div>
</div>
<p>
실행 후 터미널에 <strong>Listening for client HTTP connections on [:6060]</strong> 메세지가 뜬다면 성공이다.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-7" class="outline-2">
<h2 id="headline-7">
부록 - Go Modules를 이용해서 설치하기
</h2>
<div id="outline-text-headline-7" class="outline-text-2">
<p>
  <strong>go 1.11</strong> 버전 이후로는 <strong>Go Modules</strong> 라는 개념을 제공한다. 앞으로 Go는 기존의 <code class="verbatim">$GOPATH</code> 를 이용한 방법 대신 Go Module를 이용해서 패키지 관리를 한다고 한다. Go Modules에 대한 자세한 내용은 <a href="https://velog.io/@kimmachinegun/Go-Go-Modules-%25EC%2582%25B4%25ED%258E%25B4%25EB%25B3%25B4%25EA%25B8%25B0-7cjn4soifk">여기</a>와 <a href="https://blog.golang.org/using-go-modules">여기</a>를 참고하자. </p>
<p>
  <strong>참고로 이 부록은 위에서 설명한 가이드를 모두 따라하고 데이터베이스 관련 셋팅이 모두 끝났다고 가정한다.</strong></p>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Go modules 한방 스크립트
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>
   쉘 커맨드 명령어를 우선 한번에 작성한 후 한줄 한줄 설명하도록 하겠다.</p>
<div class="src src-shell">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git clone https://github.com/tinode/chat
cd chat/server
go mod init github.com/YeongCheon/chat/server
go build -tags mysql
mkdir static
./server -config<span style="color:#f92672">=</span>./tinode.conf</code></pre></td></tr></table>
</div>
</div>
</div>
<p>
1, 2번 라인은 별도로 설명하지 않겠다.</p>
<p>
<strong>3번 라인이 제일 중요하다.</strong>
go.mod 파일을 만드는 명령어인데 <strong>init 뒤에 붙는 패키지 경로를 자신이 정한 고유의 경로를 써줘야 한다.</strong> 처음에 아무생각 없이 <code class="verbatim">github.com/tinode/chat/server</code> 를 입력한다면 아래와 같은 에러메세지를 볼 수 있다.</p>
<div class="src src-text">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">can&#39;t load package: package github.com/tinode/chat/server: unknown import path &#34;github.com/tinode/chat/server&#34;: ambiguous import: found github.com/tinode/chat/server in multiple modules:
	github.com/tinode/chat/server (/~~~~~~~~~~~~~~~~~~~~~~~~/chat/server)
	github.com/tinode/chat v0.15.14 (/~~~~~~~~/go/pkg/mod/github.com/tinode/chat@v0.15.14/server)</code></pre></td></tr></table>
</div>
</div>
</div>
<p>
init 작업이 끝나면 의존성 패키지 목록이 이쁘게 정리된 <code class="verbatim">go.mod</code> 파일과 <code class="verbatim">go.sum</code> 파일을 볼 수 있다.</p>
<p>
그 이후의 작업은 <code class="verbatim">go install</code> 명령어를 이용해 설치했을때와 동일하다. <code class="verbatim">go build</code> 명령어 실행 시 <strong>-tags=mysql</strong> 을 붙여서 mysql을 사용하는 바이너리 파일을 생성한 후 동일한 위치에 statics 폴더를 생성한다. 그리고 마지막으로 바이너리 파일 실행 시 <strong>-config=./tinode.conf</strong> 옵션을 추가하면 정상적으로 동작한다.이 때 혹시 동작하지 않는다면  conf파일 안의 설정값을 확인해보자.</p>
</div>
</div>
</div>
</div>

    </article>

    

    <div class="disqus-comments">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yeongcheon" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

    <ul class="pager article-pager">
      <li class="pager-newer">
          <a href="/posts/2019-06-19-emacs-hangul/" data-toggle="tooltip" data-placement="top" title="이맥스 폰트, 세벌식 셋팅하기">&lt; Newer</a>
      </li>
      <li class="pager-older">
        <a href="/posts/2019-03-07-tinode001/" data-toggle="tooltip" data-placement="top" title="tinode series.001 - Intro">Older &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer">
  <div class="copyright">&copy; Copyright 2020 YeongCheon</div>
  <ul class="site-footer-items">
    <li class="site-footer-item-about"><a href="/about/" title="About">About</a></li>
  </ul>
  <div class="powerdby">
    Powered by <a href="https://gohugo.io/">Hugo</a> and <a href="https://github.com/taikii/whiteplain">Whiteplain</a>
  </div>
</div>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-135478508-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
<script data-ad-client="ca-pub-4599234083355765" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</html>
