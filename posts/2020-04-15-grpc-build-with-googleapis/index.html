<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>grpc-gateway를 이용한 JSON 통신 - 김영천 블로그</title><meta property="og:title" content="grpc-gateway를 이용한 JSON 통신 - 김영천 블로그"><meta name=twitter:title content="grpc-gateway를 이용한 JSON 통신 - 김영천 블로그"><meta name=description content="google.api.http option을 포함한 protobuf 파일을 컴파일 해봅시다."><meta property="og:description" content="google.api.http option을 포함한 protobuf 파일을 컴파일 해봅시다."><meta name=twitter:description content="google.api.http option을 포함한 protobuf 파일을 컴파일 해봅시다."><meta name=author content="YeongCheon Kim"><meta property="og:site_name" content="김영천 블로그"><meta property="og:url" content="https://yeongcheon.github.io/posts/2020-04-15-grpc-build-with-googleapis/"><meta property="og:type" content="article"><meta property="og:image" content="https://yeongcheon.github.io/images/profile_no_background.png"><meta name=twitter:image content="https://yeongcheon.github.io/images/profile_no_background.png"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=/css/style.css media=all><link rel=stylesheet href=/css/syntax.css media=all><link rel=stylesheet href=/css/custom.css media=all><script src=/js/script.js></script><script src=/js/custom.js></script><script defer src=/js/fontawesome.js></script></head><body><header class=site-header><nav class=site-navi><h1 class=site-title><a href=/><img src=/images/profile_no_background.png>김영천 블로그 - 게을러지고 싶으면 공부해야 합니다.</a></h1><ul class=site-navi-items><li class=site-navi-item-tags><a href=/tags/ title=Tags>Tags</a></li><li class=site-navi-item-archives><a href=/posts/ title=Archives>Archives</a></li><li class=site-navi-item-about><a href=/about/ title=About>About</a></li></ul></nav></header><hr class=site-header-bottom><div class=main role=main><article class=article><h1 class=article-title>grpc-gateway를 이용한 JSON 통신</h1><h2 class=article-subtitle>google.api.http option을 포함한 protobuf 파일을 컴파일 해봅시다.</h2><hr class=article-title-bottom><ul class=article-meta><li class=article-meta-date><time>April 15, 2020</time></li><li class=article-meta-tags><a href=/tags/grpc/><i class="fas fa-tag"></i>
grpc
</a>&nbsp;</li><li class=article-meta-tags><a href=/tags/protobuf/><i class="fas fa-tag"></i>
protobuf
</a>&nbsp;</li></ul><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>목표</h2><div id=outline-text-headline-1 class=outline-text-2><p><a href=https://blog.banksalad.com/tech/production-ready-grpc-in-golang/#grpc-gateway%25EB%25A5%25BC-%25EC%259D%25B4%25EC%259A%25A9%25ED%2595%259C-json-%25ED%2586%25B5%25EC%258B%25A0>grpc-gateway를 이용한 통신</a>을 하기 위해 작성한 <code>.proto</code> 파일을 컴파일 하는 방법을 알아보겠습니다.</p></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>source code</h2><div id=outline-text-headline-2 class=outline-text-2><p>우선 컴파일 하고자 하는 소스코드를 살펴봅시다. 이 코드는 <a href=https://github.com/grpc-ecosystem/grpc-gateway#usage>grpc-gateway</a>에 있는 예제와 동일합니다.</p><div class="src src-proto"><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#f92672>package</span> example;<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// myService.proto
</span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;google/api/annotations.proto&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>StringMessage</span> {<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> value <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>service</span> YourService {<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>rpc</span> Echo(StringMessage) <span style=color:#66d9ef>returns</span> (StringMessage) {<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>option</span> (google.api.http) <span style=color:#f92672>=</span> {<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      post<span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/v1/example/echo&#34;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      body<span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;*&#34;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    };<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  }<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>}</code></pre></td></tr></table></div></div></div><p>위의 예제코드에서 신경써야 할 부분은 14-17 라인에서 사용된 <code>google.api.http</code> option이다. 이 어노테이션은 사용자가 작성한 게 아니라 <a href=https://github.com/grpc-ecosystem>grpc-ecosystem</a>의 일부입니다(정확히는 <a href=https://github.com/grpc-ecosystem/grpc-gateway>grpc-gateway</a>).</p></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>에러 살펴보기</h2><div id=outline-text-headline-3 class=outline-text-2><p>우선 단순하게 <code>protoc -I. test.proto --go_out=plugins:grpc.</code> 명령어를 이용해 컴파일 하면 다음과 비슷한 메세지가 뜰 것입니다.</p><div class="src src-text"><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>google/api/annotations.proto: File not found.
myService.proto:4:1: Import &#34;google/api/annotations.proto&#34; was not found or had errors.</code></pre></td></tr></table></div></div></div><p>이제부터 이 에러를 고쳐봅시다.</p></div></div><div id=outline-container-headline-4 class=outline-2><h2 id=headline-4>FIX</h2><div id=outline-text-headline-4 class=outline-text-2><p>에러 메세지가 아주 명료하니 긴 말 하지말고 바로 방법을 알아보죠.</p><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>grpc-gateway Download</h3><div id=outline-text-headline-5 class=outline-text-3><p>우선 grpc-gateway 프로젝트를 git clone 명령어를 이용해 원하는 위치에 다운받습니다.</p><div class="src src-text"><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>git clone https://github.com/grpc-ecosystem/grpc-gateway</code></pre></td></tr></table></div></div></div></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>fix compile command</h3><div id=outline-text-headline-6 class=outline-text-3><p>컴파일 명령어에 위에서 내려받은 grpc-gateway 프로젝트의 <code>third_party/googleapis</code> 경로를 추가해줍니다.</p><div class="src src-text"><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>protoc -I. -I./grpc-gateway/third_party/googleapis/ --go_out=plugins=grpc:. myService.proto</code></pre></td></tr></table></div></div></div><p>그럼 이제 정상적으로 컴파일이 완료되는걸 확인할 수 있습니다.</p></div></div></div></div></article><div class=disqus-comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//yeongcheon.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><ul class="pager article-pager"><li class=pager-newer><a href=/posts/2020-04-26-angular-ssr-with-appengine/ data-toggle=tooltip data-placement=top title="구글 앱엔진에 ssr angular app 배포하기">&lt; Newer</a></li><li class=pager-older><a href=/posts/2020-03-24-proto-buffers-language-guide-proto3/ data-toggle=tooltip data-placement=top title="프로토 버퍼 언어 안내(proto3) 번역본">Older ></a></li></ul></div><div class=site-footer><div class=copyright>&copy; Copyright 2020 YeongCheon</div><ul class=site-footer-items><li class=site-footer-item-about><a href=/about/ title=About>About</a></li></ul><div class=powerdby>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/taikii/whiteplain>Whiteplain</a></div></div><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-135478508-1','auto'),ga('send','pageview'))</script></body><script data-ad-client=ca-pub-4599234083355765 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></html>