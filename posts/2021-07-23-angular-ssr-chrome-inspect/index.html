<!doctype html><html lang=ko>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1">
<title>angular universal 메모리 누수 개선하기 - 003 - 김영천 블로그</title>
<meta property="og:title" content="angular universal 메모리 누수 개선하기 - 003 - 김영천 블로그">
<meta name=twitter:title content="angular universal 메모리 누수 개선하기 - 003 - 김영천 블로그">
<meta name=description content="Chrome Inspect를 사용해서 Angular Universal 메모리 누수 개선하기">
<meta property="og:description" content="Chrome Inspect를 사용해서 Angular Universal 메모리 누수 개선하기">
<meta name=twitter:description content="Chrome Inspect를 사용해서 Angular Universal 메모리 누수 개선하기">
<meta name=author content="YeongCheon Kim">
<meta property="og:site_name" content="김영천 블로그">
<meta property="og:url" content="https://yeongcheon.github.io/posts/2021-07-23-angular-ssr-chrome-inspect/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://yeongcheon.github.io/images/profile_no_background.png">
<meta name=twitter:image content="https://yeongcheon.github.io/images/profile_no_background.png">
<meta name=twitter:card content="summary">
<meta name=generator content="Hugo 0.88.1">
<link rel=stylesheet href=/css/style.css media=all>
<link rel=stylesheet href=/css/syntax.css media=all>
<link rel=stylesheet href=/css/custom.css media=all>
<script src=/js/script.js></script>
<script src=/js/custom.js></script>
<script defer src=/js/fontawesome.js></script>
</head>
<body>
<header class=site-header>
<nav class=site-navi>
<h1 class=site-title>
<a href=/>
<img src=/images/profile_no_background.png>김영천 블로그 - 게을러지고 싶으면 공부해야 합니다.
</a>
</h1>
<ul class=site-navi-items>
<li class=site-navi-item-tags><a href=/tags/ title=Tags>Tags</a></li>
<li class=site-navi-item-archives><a href=/posts/ title=Archives>Archives</a></li>
<li class=site-navi-item-about><a href=/about/ title=About>About</a></li>
</ul>
</nav>
</header>
<hr class=site-header-bottom>
<div class=main role=main>
<article class=article>
<h1 class=article-title>angular universal 메모리 누수 개선하기 - 003</h1>
<h2 class=article-subtitle>Chrome Inspect를 사용해서 Angular Universal 메모리 누수 개선하기</h2>
<hr class=article-title-bottom>
<ul class=article-meta>
<li class=article-meta-date><time>July 23, 2021</time></li>
<li class=article-meta-tags>
<a href=/tags/node/>
<i class="fas fa-tag"></i>
node
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/angular/>
<i class="fas fa-tag"></i>
angular
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/chrome/>
<i class="fas fa-tag"></i>
chrome
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/inspect/>
<i class="fas fa-tag"></i>
inspect
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/node/>
<i class="fas fa-tag"></i>
node
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/memory-leak/>
<i class="fas fa-tag"></i>
memory-leak
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/promise/>
<i class="fas fa-tag"></i>
promise
</a>&nbsp;
</li>
</ul>
<aside class=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#headline-1>들어가며</a>
</li>
<li><a href=#headline-2>앱 작성</a>
<ul>
<li><a href=#headline-3>앵귤러 앱 생성</a>
</li>
<li><a href=#headline-4>universal 모듈 추가</a>
</li>
<li><a href=#headline-5>앱 동작 확인</a>
</li>
<li><a href=#headline-6>Code 작성</a>
</li>
</ul>
</li>
<li><a href=#headline-7>크롬 개발자 도구를 이용해 메모리 누수 확인</a>
<ul>
<li><a href=#headline-8>메모리 스냅샷 생성</a>
<ul>
<li><a href=#headline-9>클라이언트 환경에서 스냅샷 생성</a>
</li>
<li><a href=#headline-10>서버 환경에서 스냅샷 생성</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href=#headline-11>마무리</a>
</li>
</ul>
</nav>
</aside>
<p>
앵귤러 기반 웹사이트를 개발하면서 발생한 메모리 누수의 다양한 원인들과 그 해결법을 기록합니다.</p>
<div id=outline-container-headline-1 class=outline-2>
<h2 id=headline-1>
들어가며
</h2>
<div id=outline-text-headline-1 class=outline-text-2>
<p>
이번 문서에서는 Chrome Inspect를 이용해서 서버 사이드 렌더링 시 발생하는 메모리 누수를 확인하고 이를 수정하는 방법에 대해 알아봅니다. 이 문서는 <a href=https://angular.kr/guide/universal>Angular Universal</a>에 대해 기본적인 이해가 있다는 것을 전제로 작성되었습니다.</p>
</div>
</div>
<div id=outline-container-headline-2 class=outline-2>
<h2 id=headline-2>
앱 작성
</h2>
<div id=outline-text-headline-2 class=outline-text-2>
<p>
직접 밑바닥부터 코드를 작성해가며 문제를 재현해봅시다.</p>
<div id=outline-container-headline-3 class=outline-3>
<h3 id=headline-3>
앵귤러 앱 생성
</h3>
<div id=outline-text-headline-3 class=outline-text-3>
<p>
다음 명령어를 이용해 앵귤러 앱을 생성해줍니다.</p>
<div class="src src-shell">
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ng new sample</code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-4 class=outline-3>
<h3 id=headline-4>
universal 모듈 추가
</h3>
<div id=outline-text-headline-4 class=outline-text-3>
<p>
다음 명령어를 이용해 universal 관련 모듈을 추가해줍니다.</p>
<div class="src src-shell">
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ng add @nguniversal/express-engine</code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-5 class=outline-3>
<h3 id=headline-5>
앱 동작 확인
</h3>
<div id=outline-text-headline-5 class=outline-text-3>
<p>
다음 명령어를 이용해 앵귤러 서버를 실행 후 앱이 동작하는지 확인합니다.</p>
<div class="src src-shell">
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>npm run dev:ssr</code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-6 class=outline-3>
<h3 id=headline-6>
Code 작성
</h3>
<div id=outline-text-headline-6 class=outline-text-3>
<p>
<strong>문제가 발생하는</strong> 코드를 작성해봅시다. <code>app.component.ts</code> 파일의 <code>ngOnInit</code> 내부에 다음과 같은 코드를 작성해줍니다.</p>
<div class="src src-typescript">
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript>
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;

<span style=color:#66d9ef>@Component</span>({
<span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-root&#39;</span>,
<span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./app.component.html&#39;</span>,
<span style=color:#a6e22e>styleUrls</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;./app.component.scss&#39;</span>],
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppComponent</span> {
<span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sample&#39;</span>;

<span style=color:#a6e22e>ngOnInit() {</span>
 <span style=color:#a6e22e>setInterval</span>(() <span style=color:#f92672>=&gt;</span> {
   <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>promise</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>string</span>&gt;((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) <span style=color:#f92672>=&gt;</span> {
     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>wrongPromise</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>string</span>&gt;((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) <span style=color:#f92672>=&gt;</span> { });

     <span style=color:#a6e22e>setInterval</span>(() <span style=color:#f92672>=&gt;</span> {
       <span style=color:#a6e22e>wrongPromise</span>.<span style=color:#a6e22e>then</span>(() <span style=color:#f92672>=&gt;</span> {
         <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;never execute&#39;</span>);
       });
     }, <span style=color:#ae81ff>100</span>);
   });

   <span style=color:#a6e22e>promise</span>.<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>res</span>) <span style=color:#f92672>=&gt;</span> {
     <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>res</span>);
   });
 }, <span style=color:#ae81ff>3000</span>);
}
}</code></pre></td></tr></table>
</div>
</div>
</div>
<p>
컴포넌트 생성 시 100ms마다 절대로 실행되지 않는 Promise를 생성하는 코드입니다. 생성된 Promise는 컴포넌트가 Destroy되어도 계속 메모리에 상주하여 성능에 문제를 일으키케 됩니다. </p>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-7 class=outline-2>
<h2 id=headline-7>
크롬 개발자 도구를 이용해 메모리 누수 확인
</h2>
<div id=outline-text-headline-7 class=outline-text-2>
<div id=outline-container-headline-8 class=outline-3>
<h3 id=headline-8>
메모리 스냅샷 생성
</h3>
<div id=outline-text-headline-8 class=outline-text-3>
<div id=outline-container-headline-9 class=outline-4>
<h4 id=headline-9>
클라이언트 환경에서 스냅샷 생성
</h4>
<div id=outline-text-headline-9 class=outline-text-4>
<p>
위에서 작성한 프로그램을 <code>ng serve</code> 명령어를 이용해 실행 후 크롬 브라우저를 이용해 해당 페이지에 접근, <code>F12</code> 키를 눌러 개발자 도구를 실행한 뒤 <code>Memory</code> 탭에 접급합니다.</p>
<p>
<img src="/images/Screenshot from 2021-08-08 16-53-15.png" alt="/images/Screenshot from 2021-08-08 16-53-15.png" title="/images/Screenshot from 2021-08-08 16-53-15.png"></p>
<p>
<code>Take snapshot</code> 버튼을 3~5초 간격으로 눌러서 시간별 메모리 스냅샷을 기록합니다. 그 후 'Heap Snapshots' 목록에서 가장 최근에 생성된 스냅샷을 클릭 후 <code>(closure)</code> 리스트를 열어보면 다음과 같이 여러번 생성되어 메모리에 남아있는 Promise를 확인할 수 있습니다.</p>
<p>
<img src="/images/Screenshot from 2021-08-08 17-20-40.png" alt="/images/Screenshot from 2021-08-08 17-20-40.png" title="/images/Screenshot from 2021-08-08 17-20-40.png"></p>
</div>
</div>
<div id=outline-container-headline-10 class=outline-4>
<h4 id=headline-10>
서버 환경에서 스냅샷 생성
</h4>
<div id=outline-text-headline-10 class=outline-text-4>
<p>
브라우저가 아닌 서버에서 메모리 누수가 있는지 확인하기 위해선 우선 universal용으로 빌드를 새로 해야합니다. </p>
<div class="src src-shell">
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  ng build <span style=color:#f92672>&amp;&amp;</span> ng run &lt;app-name&gt;:server --configuration development</code></pre></td></tr></table>
</div>
</div>
</div>
<p>명령어 입력 시 <code>&lt;app-name></code> 자리에는 사용자가 ng new 명령어 실행 시 입력한 어플리케이션 이름을 입력해야 합니다. 그리고 <code>--configuration development</code> 옵션을 추가한 이유는 sourceMap을 활성화 하기 위해서입니다. 기본적으로 앵귤러는 서버 빌드 시 production 설정으로 빌드를 수행하기 때문에 빌드 결과값이 minify되어 사람이 읽기 어려운 형태로 출력됩니다. 따라서 개발자가 작성한 소스코드를 크롬 개발자 도구에서 바로 연동해서 볼 수 있도록 sourceMap 옵션이 활성화 되어있는 development 설정값을 기본으로 셋팅하여 빌드를 수행하여야 합니다.</p>
<p>
빌드가 완료됐으면 <code>package.json</code> 파일을 열어 <code>serve:ssr</code> 명령어에 <code>--inspect</code> 인자를 추가해야 합니다.</p>
<div class="src src-json">
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
	<span style=color:#f92672>&#34;ng&#34;</span>: <span style=color:#e6db74>&#34;ng&#34;</span>,
	<span style=color:#f92672>&#34;start&#34;</span>: <span style=color:#e6db74>&#34;ng serve&#34;</span>,
	<span style=color:#f92672>&#34;build&#34;</span>: <span style=color:#e6db74>&#34;ng build&#34;</span>,
	<span style=color:#f92672>&#34;watch&#34;</span>: <span style=color:#e6db74>&#34;ng build --watch --configuration development&#34;</span>,
	<span style=color:#f92672>&#34;test&#34;</span>: <span style=color:#e6db74>&#34;ng test&#34;</span>,
	<span style=color:#f92672>&#34;dev:ssr&#34;</span>: <span style=color:#e6db74>&#34;ng run sample:serve-ssr&#34;</span>,
	<span style=color:#f92672>&#34;serve:ssr&#34;</span>: <span style=color:#e6db74>&#34;node --inspect dist/sample/server/main.js&#34;</span>, <span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>여기에</span> <span style=color:#960050;background-color:#1e0010>--inspect</span> <span style=color:#960050;background-color:#1e0010>인자값을</span> <span style=color:#960050;background-color:#1e0010>추가해야</span> <span style=color:#960050;background-color:#1e0010>합니다.</span>
	<span style=color:#f92672>&#34;build:ssr&#34;</span>: <span style=color:#e6db74>&#34;ng build &amp;&amp; ng run sample:server&#34;</span>,
	<span style=color:#f92672>&#34;prerender&#34;</span>: <span style=color:#e6db74>&#34;ng run sample:prerender&#34;</span>
}<span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#960050;background-color:#1e0010>...</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
이 후 <code>npm run serve:ssr</code> 명령어를 이용해 서버를 실행한 후 크롬의 주소창에 <code>chrome://inspect</code> 를 입력하면 다음과 같은 화면을 볼 수 있습니다.</p>
<p>
<img src="/images/Screenshot from 2021-08-08 17-37-39.jpg" alt="/images/Screenshot from 2021-08-08 17-37-39.jpg" title="/images/Screenshot from 2021-08-08 17-37-39.jpg"></p>
<p>
Remote Target 하단의 main.js가 조금 전에 실행시킨 서버입니다. inspect를 누르면 브라우저 환경에서 Memory 탭에 접근했을때와 동일한 화면이 나타납니다.</p>
<p>
<img src="/images/Screenshot from 2021-08-08 20-36-51.png" alt="/images/Screenshot from 2021-08-08 20-36-51.png" title="/images/Screenshot from 2021-08-08 20-36-51.png"></p>
<p>
이제 크롬에서 <a href=http://localhost:4000>http://localhost:4000</a> 링크에 접근 후 위의 Devtool에서 Take snapshoot을 누르면 서버의 메모리 상태를 캡쳐할 수 있습니다. 다만 현재 이 예제의 소스코드는 setInterval이 무한히 실행되기 때문에 서버가 응답을 하지는 않습니다. 하지만 응답을 기다리는 동안 Devltool에서 일정 간격으로 서버 메모리 상태를 캡쳐하여 closure 목록을 열어보면 다음과 유사한 모습을 확인할 수 있습니다.</p>
<p>
<img src="/images/Screenshot from 2021-08-08 20-42-32.png" alt="/images/Screenshot from 2021-08-08 20-42-32.png" title="/images/Screenshot from 2021-08-08 20-42-32.png"></p>
<p>
위의 이미지처럼 동일한 코드라인이 반복된다면 메모리 누수를 의심해 볼 수 있습니다.</p>
<p>
실제 개발을 하다보면 클라이언트에서 응답을 받았음에도 서버에서는 위와 같이 계속 메모리에 값이 쌓여 결국 서버가 죽어버리는 상황이 발생하기도 합니다.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-11 class=outline-2>
<h2 id=headline-11>
마무리
</h2>
<div id=outline-text-headline-11 class=outline-text-2>
<p>
메모리 누수는 다양한 원인으로 인해 발생할 수 있습니다. 하지만 위에서 설명한 내용대로 테스트를 진행하면 메모리 누수의 원인이 무엇이든 어디서 누수가 발생하는지 쉽게 파악할 수 있습니다. 만약 개발시에는 문제없이 동작하는 코드가 실제 배포 후 일정 주기로, 또는 이유없이 종종 서버가 죽어버리는 경우엔 메모리 누수를 의심해보고 테스트를 꼼꼼히 해보시는걸 권장합니다.</p>
</div>
</div>
</article>
<div class=disqus-comments>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//yeongcheon.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<ul class="pager article-pager">
<li class=pager-newer>
<a href=/posts/2021-09-08-http-call-in-docker-container/ data-toggle=tooltip data-placement=top title="도커 컨테이너 안에서 외부 URL 호출하기">&lt; Newer</a>
</li>
<li class=pager-older>
<a href=/posts/2021-07-15-angular-memory-leak002/ data-toggle=tooltip data-placement=top title="angular universal 메모리 누수 개선하기 - 002">Older ></a>
</li>
</ul>
</div>
<div class=site-footer>
<div class=copyright>&copy; Copyright 2020 YeongCheon</div>
<ul class=site-footer-items>
<li class=site-footer-item-about><a href=/about/ title=About>About</a></li>
</ul>
<div class=powerdby>
Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/taikii/whiteplain>Whiteplain</a>
</div>
</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0YT8RHXZR3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-0YT8RHXZR3',{anonymize_ip:!1})}</script>
</body>
<script data-ad-client=ca-pub-4599234083355765 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
</html>