<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>appengine + springboot + kotlin + jpa + cloudsql 연동하기 - 김영천 블로그</title><meta name=Description content="게을러지고 싶으면 공부해야 합니다."><meta property="og:title" content="appengine + springboot + kotlin + jpa + cloudsql 연동하기"><meta property="og:description" content="회사에서 새로 시작하는 API 서버 개발에 아래와 같은 환경을 적용하기로 했다. 구동환경 : Google App Engine Standard Environment 언어 : kotlin 1.3 framework : Spring Boot 2.0.2.RELEASE DB : cloud sql(MySQL 5.7) ORM : hibernate/JPA IDE: IntelliJ Ultimate 각각 놓고보면 다"><meta property="og:type" content="article"><meta property="og:url" content="https://yeongcheon.github.io/posts/2018-11-11-springboot-jpa-cloudsql-connect/"><meta property="og:image" content="https://yeongcheon.github.io/images/profile_no_background.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-11T19:00:00+09:00"><meta property="article:modified_time" content="2019-03-03T18:35:34+09:00"><meta property="og:site_name" content="김영천 블로그"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yeongcheon.github.io/images/profile_no_background.png"><meta name=twitter:title content="appengine + springboot + kotlin + jpa + cloudsql 연동하기"><meta name=twitter:description content="회사에서 새로 시작하는 API 서버 개발에 아래와 같은 환경을 적용하기로 했다. 구동환경 : Google App Engine Standard Environment 언어 : kotlin 1.3 framework : Spring Boot 2.0.2.RELEASE DB : cloud sql(MySQL 5.7) ORM : hibernate/JPA IDE: IntelliJ Ultimate 각각 놓고보면 다"><meta name=application-name content="김영천 블로그"><meta name=apple-mobile-web-app-title content="김영천 블로그"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yeongcheon.github.io/posts/2018-11-11-springboot-jpa-cloudsql-connect/><link rel=prev href=https://yeongcheon.github.io/posts/2018-09-27-emacs-selectall/><link rel=next href=https://yeongcheon.github.io/posts/2019-03-01-jpa-jackson/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"appengine + springboot + kotlin + jpa + cloudsql 연동하기","inLanguage":"ko","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yeongcheon.github.io\/posts\/2018-11-11-springboot-jpa-cloudsql-connect\/"},"genre":"posts","keywords":"spring, jpa, gae","wordcount":1288,"url":"https:\/\/yeongcheon.github.io\/posts\/2018-11-11-springboot-jpa-cloudsql-connect\/","datePublished":"2018-11-11T19:00:00+09:00","dateModified":"2019-03-03T18:35:34+09:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"YeongCheon Kim"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="김영천 블로그"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/profile_no_background.png data-srcset="/images/profile_no_background.png, /images/profile_no_background.png 1.5x, /images/profile_no_background.png 2x" data-sizes=auto alt=/images/profile_no_background.png title=/images/profile_no_background.png>김영천 블로그<span class=header-title-post><sup>"게을러지고 싶으면 공부해야 합니다."</sup></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="테마 변경">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="김영천 블로그"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/profile_no_background.png data-srcset="/images/profile_no_background.png, /images/profile_no_background.png 1.5x, /images/profile_no_background.png 2x" data-sizes=auto alt=/images/profile_no_background.png title=/images/profile_no_background.png>김영천 블로그<span class=header-title-post><sup>"게을러지고 싶으면 공부해야 합니다."</sup></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="테마 변경">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>목차</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">appengine + springboot + kotlin + jpa + cloudsql 연동하기</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/yeongcheon title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>YeongCheon Kim</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2018-11-11>2018-11-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1288 단어&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;읽는데 약 3분&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>목차</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#buildgradle-작성>build.gradle 작성</a></li><li><a href=#appengine-webxml-파일-작성>appengine-web.xml 파일 작성</a></li><li><a href=#main-class-작성하기>main class 작성하기</a></li></ul></nav></div></div><div class=content id=content><p>회사에서 새로 시작하는 API 서버 개발에 아래와 같은 환경을 적용하기로 했다.</p><ul><li>구동환경 : <a href=https://cloud.google.com/appengine/docs/standard/java/ target=_blank rel="noopener noreffer">Google App Engine Standard Environment</a></li><li>언어 : <a href=https://kotlinlang.org/ target=_blank rel="noopener noreffer">kotlin 1.3</a></li><li>framework : <a href=https://spring.io/projects/spring-boot target=_blank rel="noopener noreffer">Spring Boot 2.0.2.RELEASE</a></li><li>DB : <a href=https://cloud.google.com/sql/docs/mysql/ target=_blank rel="noopener noreffer">cloud sql(MySQL 5.7)</a></li><li>ORM : <a href=https://opentutorials.org/module/1281 target=_blank rel="noopener noreffer">hibernate/JPA</a></li><li>IDE: <a href=https://www.jetbrains.com/idea/ target=_blank rel="noopener noreffer">IntelliJ Ultimate</a></li></ul><p>각각 놓고보면 다들 유명하고 널리 쓰이는 기술들이지만 얘들을 한꺼번에 적용한 가이드라인이 없어서 내가 직접 가이드를 작성해볼까 한다. A to Z 형식의 가이드는 아니고 셋팅 중 삽질을 크게 했던 부분 위주로 작성해보도록 하겠다.</p><h2 id=buildgradle-작성>build.gradle 작성</h2><p>의존성 관리를 위한 build.gradle 파일이다. 아래의 코드 내용은 <a href=https://start.spring.io/ target=_blank rel="noopener noreffer">spring initializer</a>를 통해서 생성된 프로젝트를 바탕으로 이것저것 수정한 버전이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buildscript</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>ext</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>kotlinVersion</span> <span class=o>=</span> <span class=s1>&#39;1.3.0&#39;</span>
</span></span><span class=line><span class=cl>		<span class=n>springBootVersion</span> <span class=o>=</span> <span class=s1>&#39;2.0.2.RELEASE&#39;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=n>repositories</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>jcenter</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=n>mavenCentral</span><span class=o>()</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>classpath</span> <span class=s1>&#39;com.google.cloud.tools:appengine-gradle-plugin:1.+&#39;</span>    <span class=c1>// latest App Engine Gradle tasks
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>classpath</span><span class=o>(</span><span class=s2>&#34;org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=n>classpath</span><span class=o>(</span><span class=s2>&#34;org.jetbrains.kotlin:kotlin-gradle-plugin:${kotlinVersion}&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=n>classpath</span> <span class=s2>&#34;org.jetbrains.kotlin:kotlin-allopen:$kotlinVersion&#34;</span>
</span></span><span class=line><span class=cl>		<span class=n>classpath</span> <span class=s1>&#39;com.google.gms:google-services:4.1.0&#39;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plugins</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>id</span> <span class=s2>&#34;org.jetbrains.kotlin.plugin.spring&#34;</span> <span class=n>version</span> <span class=s1>&#39;1.3.0&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>id</span> <span class=s2>&#34;org.jetbrains.kotlin.plugin.noarg&#34;</span> <span class=n>version</span> <span class=s1>&#39;1.3.0&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>id</span> <span class=s2>&#34;org.jetbrains.kotlin.plugin.allopen&#34;</span> <span class=n>version</span> <span class=s1>&#39;1.3.0&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;java&#39;</span>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;kotlin&#39;</span>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;org.springframework.boot&#39;</span>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;org.jetbrains.kotlin.plugin.spring&#39;</span>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;kotlin-jpa&#39;</span>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;kotlin-noarg&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;kotlin-kapt&#39;</span>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;idea&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s2>&#34;kotlin-allopen&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;war&#39;</span>                               <span class=c1>// standard Web Archive plugin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>apply</span> <span class=nl>plugin:</span> <span class=s1>&#39;com.google.cloud.tools.appengine&#39;</span>  <span class=c1>// App Engine tasks
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>noArg</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>annotation</span><span class=o>(</span><span class=s2>&#34;javax.persistence.Entity&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>allOpen</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>annotation</span><span class=o>(</span><span class=s2>&#34;javax.persistence.Entity&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>group</span> <span class=o>=</span> <span class=s1>&#39;com.companyname&#39;</span>
</span></span><span class=line><span class=cl><span class=n>version</span> <span class=o>=</span> <span class=s1>&#39;0.0.1-SNAPSHOT&#39;</span>
</span></span><span class=line><span class=cl><span class=n>sourceCompatibility</span> <span class=o>=</span> <span class=mf>1.8</span>
</span></span><span class=line><span class=cl><span class=n>compileKotlin</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>kotlinOptions</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>freeCompilerArgs</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;-Xjsr305=strict&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>		<span class=n>jvmTarget</span> <span class=o>=</span> <span class=s2>&#34;1.8&#34;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=n>compileTestKotlin</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>kotlinOptions</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>freeCompilerArgs</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;-Xjsr305=strict&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>		<span class=n>jvmTarget</span> <span class=o>=</span> <span class=s2>&#34;1.8&#34;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>repositories</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>mavenCentral</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>implementation</span><span class=o>(</span><span class=s1>&#39;com.google.appengine:appengine:+&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=n>implementation</span><span class=o>(</span><span class=s1>&#39;com.google.appengine:appengine-api-1.0-sdk:+&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=n>implementation</span><span class=o>(</span><span class=s1>&#39;com.google.appengine.tools:appengine-gcs-client:0.8&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// kotlin
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>compile</span> <span class=s2>&#34;org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;org.jetbrains.kotlin:kotlin-reflect:$kotlinVersion&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// spring boot
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>compile</span> <span class=s2>&#34;org.springframework.boot:spring-boot-starter-web:${springBootVersion}&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;org.springframework.boot:spring-boot-starter-data-jpa:${springBootVersion}&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;org.springframework.boot:spring-boot-starter-jdbc:${springBootVersion}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// jackson
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>compile</span> <span class=s2>&#34;com.fasterxml.jackson.datatype:jackson-datatype-jdk8&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;com.fasterxml.jackson.datatype:jackson-datatype-jsr310&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;com.fasterxml.jackson.datatype:jackson-datatype-hibernate5:2.+&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;com.fasterxml.jackson.module:jackson-module-kotlin:2.+&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// db: hibernate
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>compile</span> <span class=s2>&#34;org.hibernate:hibernate-core:5.2.7.Final&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;org.hibernate:hibernate-entitymanager:5.2.7.Final&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s2>&#34;org.hibernate:hibernate-java8:5.2.7.Final&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=nl>group:</span> <span class=s1>&#39;org.qlrm&#39;</span><span class=o>,</span> <span class=nl>name:</span> <span class=s1>&#39;qlrm&#39;</span><span class=o>,</span> <span class=nl>version:</span> <span class=s1>&#39;2.0.2&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//db : mysql
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>implementation</span><span class=o>(</span><span class=s1>&#39;mysql:mysql-connector-java:5.+&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=n>implementation</span><span class=o>(</span><span class=s1>&#39;com.google.cloud.sql:mysql-socket-factory-connector-j-8:1.0.11&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=n>implementation</span><span class=o>(</span><span class=s1>&#39;com.google.cloud.sql:mysql-socket-factory:1.0.11&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>compile</span> <span class=s1>&#39;javax.xml.bind:jaxb-api:2.3.0&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>testImplementation</span><span class=o>(</span><span class=s1>&#39;org.springframework.boot:spring-boot-starter-test:2.0.2.RELEASE&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=n>testImplementation</span> <span class=s1>&#39;com.google.appengine:appengine-testing:1.+&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>testImplementation</span> <span class=s1>&#39;com.google.appengine:appengine-api-stubs:1.+&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>testImplementation</span> <span class=s1>&#39;com.google.appengine:appengine-tools-sdk:1.+&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>appengine</span> <span class=o>{</span>  <span class=c1>// App Engine tasks configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>deploy</span> <span class=o>{</span>   <span class=c1>// deploy configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=appengine-webxml-파일-작성>appengine-web.xml 파일 작성</h2><p>보통 스프링의 각종 프로퍼티들은 <code>resources/application.properties</code>에 작성하는 경우가 많다(요즘에는 <code>yml</code> 파일로 많이들 작성한다고 카더라). 하지만 우리는 App Engine 환경에서 서버를 실행할 것이기 때문에 <code>webapp/WEB-INF/appengine-web.xml</code>에 각종 프로퍼티들을 선언해 줄 것이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;appengine-web-app</span> <span class=na>xmlns=</span><span class=s>&#34;http://appengine.google.com/ns/1.0&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;threadsafe&gt;</span>true<span class=nt>&lt;/threadsafe&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;runtime&gt;</span>java8<span class=nt>&lt;/runtime&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;env&gt;</span>standard<span class=nt>&lt;/env&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;use-google-connector-j&gt;</span>true<span class=nt>&lt;/use-google-connector-j&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;system-properties&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.datasource.continue-on-error&#34;</span> <span class=na>value=</span><span class=s>&#34;true&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.datasource.initialization-mode&#34;</span> <span class=na>value=</span><span class=s>&#34;always&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.jackson.serialization.fail-on-empty-beans&#34;</span> <span class=na>value=</span><span class=s>&#34;false&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.jpa.hibernate.ddl-auto&#34;</span> <span class=na>value=</span><span class=s>&#34;update&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.jpa.properties.hibernate.hbm2ddl.auto&#34;</span> <span class=na>value=</span><span class=s>&#34;update&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.jpa.properties.hibernate.dialect&#34;</span> <span class=na>value=</span><span class=s>&#34;org.hibernate.dialect.MySQL57Dialect&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.jpa.properties.hibernate.id.new_generator_mappings&#34;</span> <span class=na>value=</span><span class=s>&#34;true&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.jpa.properties.hibernate.format_sql&#34;</span> <span class=na>value=</span><span class=s>&#34;true&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.datasource.url&#34;</span> <span class=na>value=</span><span class=s>&#34;jdbc:mysql://google/&lt;DATABASE_NAME&gt;?cloudSqlInstance=&lt;INSTANCE_CONNECTION_NAME&gt;&amp;socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;user=&lt;MYSQL_USER_NAME&gt;&amp;password=&lt;MYSQL_USER_PASSWORD&gt;&amp;useSSL=false&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/system-properties&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/appengine-web-app&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>위 내용들을 <code>application.properties</code>에 형식을 맞춰서 작성해도 동작이 되긴 하는듯 하다. 하지만 구글의 앱엔진 가이드에는 <code>appengine-web.xml</code>에 작성하는걸 기준으로 설명하고 있으니 일단은 위와 같이 작성해두도록 하겠다.</p><p>위 내용에서 내가 특히 헤맸던 설정이 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;spring.jpa.properties.hibernate.dialect&#34;</span> <span class=na>value=</span><span class=s>&#34;org.hibernate.dialect.MySQL57Dialect&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>이 옵션인데 현재 내가 최초에 적용했던 값은 <code>org.hibernate.dialect.MySQL5Dialect</code>였다(<code>7</code>이 빠졌다). 하이버네이트를 MySQL5 버전에 연결하기 위한 옵션값인데 <em>로컬서버에 설치된 MYSQL5.7에 연결했을때는 아무 문제도 없었다.</em> 근데 앱엔진에 배포하고 테스트를 해보니 하이버네이트가 DB에 연결을 못하고 있었다. 그래서 열심히 구글링을 해본 결과 저 dialect 값이 문제였다. 이유는 모르겠다. 아마 앱엔진에서 CloudSQL에 접근할때 사용되는 프록시와 연관이 있을지도..? 아무튼 <strong><code>MySQL57Dialect</code>라고 정확히 명시를 해줘야 앱엔진 환경에서도 DB에 문제없이 연결이 된다.</strong></p><h2 id=main-class-작성하기>main class 작성하기</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@SpringBootApplication</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Application</span> <span class=p>:</span> <span class=n>SpringBootServletInitializer</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>hibernate5Module</span><span class=p>():</span> <span class=n>Module</span> <span class=p>{</span> <span class=c1>//for jpa lazy loading
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>Hibernate5Module</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>main</span><span class=p>(</span><span class=n>args</span><span class=p>:</span> <span class=n>Array</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>SpringApplication</span><span class=p>.</span><span class=n>run</span><span class=p>(</span><span class=n>Application</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>,</span> <span class=p>*</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>여기까지 작성한다면 API 개발을 위한 기본적인 셋팅이 완료된 것이다. 이제 <code>@Controller</code>, <code>@Service</code> 등등을 작성하면서 API를 완성해나가면 된다.</p><p>참고 : <a href=https://blog.sapzil.org/2017/11/02/kotlin-jpa-pitfalls/ target=_blank rel="noopener noreffer">Kotlin에서 JPA 사용할 때 주의할 점</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>수정: 2019-03-03</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/2018-11-11-springboot-jpa-cloudsql-connect/index.md target=_blank>마크다운 읽기</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="공유하기 Twitter" data-sharer=twitter data-url=https://yeongcheon.github.io/posts/2018-11-11-springboot-jpa-cloudsql-connect/ data-title="appengine + springboot + kotlin + jpa + cloudsql 연동하기" data-hashtags=spring,jpa,gae><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="공유하기 Facebook" data-sharer=facebook data-url=https://yeongcheon.github.io/posts/2018-11-11-springboot-jpa-cloudsql-connect/ data-hashtag=spring><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="공유하기 Hacker News" data-sharer=hackernews data-url=https://yeongcheon.github.io/posts/2018-11-11-springboot-jpa-cloudsql-connect/ data-title="appengine + springboot + kotlin + jpa + cloudsql 연동하기"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="공유하기 Pocket" data-sharer=pocket data-url=https://yeongcheon.github.io/posts/2018-11-11-springboot-jpa-cloudsql-connect/><i class="fab fa-get-pocket fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/spring/>spring</a>,&nbsp;<a href=/tags/jpa/>jpa</a>,&nbsp;<a href=/tags/gae/>GAE</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>뒤로</a></span>&nbsp;|&nbsp;<span><a href=/>홈</a></span></section></div><div class=post-nav><a href=/posts/2018-09-27-emacs-selectall/ class=prev rel=prev title="emacs에서 커서이동 없이 buffer 전체 복사하기"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>emacs에서 커서이동 없이 buffer 전체 복사하기</a>
<a href=/posts/2019-03-01-jpa-jackson/ class=next rel=next title="jackson을 이용해 json 변환 시 JPA entity의 id값만 추출하기">jackson을 이용해 json 변환 시 JPA entity의 id값만 추출하기<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a>로 제작된 사이트 | 테마 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/yeongcheon target=_blank>YeongCheon Kim</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="맨 위로"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="댓글 보기"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=https://yeongcheon.disqus.com/embed.js defer></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"복사하기",maxShownLines:50},comment:{},cookieconsent:{content:{dismiss:"알겠습니다",link:"더 보기",message:"본 웹사이트는 웹 환경 개선을 위해 쿠키를 사용합니다."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0YT8RHXZR3",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-0YT8RHXZR3" async></script></body></html>