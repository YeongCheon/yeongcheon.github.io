<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>Android Cross-App Scripting 해결하기 - 김영천 블로그</title><meta property="og:title" content="Android Cross-App Scripting 해결하기 - 김영천 블로그"><meta name=twitter:title content="Android Cross-App Scripting 해결하기 - 김영천 블로그"><meta name=description content="웹뷰 기반 하이브리드 앱에서 크로스 앱 스크립팅 문제 해결하기"><meta property="og:description" content="웹뷰 기반 하이브리드 앱에서 크로스 앱 스크립팅 문제 해결하기"><meta name=twitter:description content="웹뷰 기반 하이브리드 앱에서 크로스 앱 스크립팅 문제 해결하기"><meta name=author content="YeongCheon Kim"><meta property="og:site_name" content="김영천 블로그"><meta property="og:url" content="https://yeongcheon.github.io/posts/2022-05-08-android-cross-app-scripting/"><meta property="og:type" content="article"><meta property="og:image" content="https://yeongcheon.github.io/images/profile_no_background.png"><meta name=twitter:image content="https://yeongcheon.github.io/images/profile_no_background.png"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.101.0"><link rel=stylesheet href=/css/style.css media=all><link rel=stylesheet href=/css/syntax.css media=all><link rel=stylesheet href=/css/custom.css media=all><script src=/js/script.js></script>
<script src=/js/custom.js></script>
<script defer src=/js/fontawesome.js></script></head><body><header class=site-header><nav class=site-navi><h1 class=site-title><a href=/><img src=/images/profile_no_background.png>김영천 블로그 - 게을러지고 싶으면 공부해야 합니다.</a></h1><ul class=site-navi-items><li class=site-navi-item-tags><a href=/tags/ title=Tags>Tags</a></li><li class=site-navi-item-archives><a href=/posts/ title=Archives>Archives</a></li><li class=site-navi-item-about><a href=/about/ title=About>About</a></li></ul></nav></header><hr class=site-header-bottom><div class=main role=main><article class=article><h1 class=article-title>Android Cross-App Scripting 해결하기</h1><h2 class=article-subtitle>웹뷰 기반 하이브리드 앱에서 크로스 앱 스크립팅 문제 해결하기</h2><hr class=article-title-bottom><ul class=article-meta><li class=article-meta-date><time>May 8, 2022</time></li><li class=article-meta-tags><a href=/tags/android/><i class="fas fa-tag"></i>
android
</a>&nbsp;</li><li class=article-meta-tags><a href=/tags/security/><i class="fas fa-tag"></i>
security
</a>&nbsp;</li><li class=article-meta-tags><a href=/tags/%EB%B3%B4%EC%95%88/><i class="fas fa-tag"></i>
보안
</a>&nbsp;</li><li class=article-meta-tags><a href=/tags/%ED%81%AC%EB%A1%9C%EC%8A%A4%EC%95%B1%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8C%85/><i class="fas fa-tag"></i>
크로스앱스크립팅
</a>&nbsp;</li></ul><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>문제</h2><div id=outline-text-headline-1 class=outline-text-2><p>운영중인 안드로이드 앱을 플레이스토어에 업데이트 하다가 구글 측에서 <a href=https://support.google.com/faqs/answer/9084685>교차 앱 스크립팅</a> 취약정 문제가 있다는 메일을 받았습니다. 구글 측에서 제공한 가이드대로 조치를 취했는데도 여전히 문제가 있다는 리포트를 받아서 문제의 원인 해결방법을 기록하고자 합니다.</p></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>원인</h2><div id=outline-text-headline-2 class=outline-text-2><p>FCM을 통해 전달된 URL이 문제였습니다(<a href=https://blog.ysoft.kr/40>링크 참고</a>). 운영 중인 앱은 FCM을 통해 전달받은 URL을 별도의 조치 없이 그대로 webview에서 로드하는 방식으로 운영되고 있었습니다. 이 URL은 저희 측에서 만든 서버에서 보내주는 URL이라 별도로 유효성 검사 없이 제공해도 문제가 없다고 판단해서 이러한 방식을 선택했는데 이 부분이 문제였습니다.</p></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>해결 방법</h2><div id=outline-text-headline-3 class=outline-text-2><p>URI는 앱 내부에 별도 변수로 관리, URL은 FCM에서 넘겨준 데이터를 그대로 사용하지 말고 uri 뒤의 path, queryParameter 부분만 추출하여 앱 내부에서 관리하는 URI와 조합하여 사용합니다. 아래와 같이 작업하면 이슈가 해결된 것으로 판단하여 스토어 업로드가 승인됩니다.</p><div class="src src-kotlin"><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> URI = <span style=color:#e6db74>&#34;https://example.com&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>val</span> data: String = intent.dataString <span style=color:#75715e>// &#34;https://example.com/path?param=test&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> url = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${URI}${data.replace(URI, &#34;&#34;)}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>webview.loadUrl(url)</span></span></code></pre></td></tr></table></div></div></div><p><strong>구글은 외부에서 넘어오는 모든 URL을 신용하지 않는 것으로 추측됩니다.</strong></p></div></div></article><div class=disqus-comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//yeongcheon.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><ul class="pager article-pager"><li class=pager-newer><a href=/posts/2022-07-23-action-in-rust-review/ data-toggle=tooltip data-placement=top title="한 줄 한 줄 짜면서 익히는 러스트 프로그래밍 책 리뷰">&lt; Newer</a></li><li class=pager-older><a href=/posts/2021-12-26-spring-aop-superclass/ data-toggle=tooltip data-placement=top title="Spring Pointcut 표현식에 부모 클래스 표현하기">Older ></a></li></ul></div><div class=site-footer><div class=copyright>&copy; Copyright 2020 YeongCheon</div><ul class=site-footer-items><li class=site-footer-item-about><a href=/about/ title=About>About</a></li></ul><div class=powerdby>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/taikii/whiteplain>Whiteplain</a></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-0YT8RHXZR3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0YT8RHXZR3",{anonymize_ip:!1})}</script></body><script data-ad-client=ca-pub-4599234083355765 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></html>