<!doctype html><html lang=ko>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1">
<title>GCP - 김영천 블로그</title>
<meta property="og:title" content="GCP - 김영천 블로그">
<meta name=twitter:title content="GCP - 김영천 블로그">
<meta name=author content="YeongCheon Kim">
<meta property="og:site_name" content="김영천 블로그">
<meta property="og:url" content="https://yeongcheon.github.io/tags/gcp/">
<meta property="og:type" content="website">
<meta property="og:image" content="https://yeongcheon.github.io/images/profile_no_background.png">
<meta name=twitter:image content="https://yeongcheon.github.io/images/profile_no_background.png">
<meta name=twitter:card content="summary">
<meta name=generator content="Hugo 0.88.1">
<link href=/tags/gcp/index.xml rel=alternate type=application/rss+xml title="김영천 블로그">
<link href=/tags/gcp/index.xml rel=feed type=application/rss+xml title="김영천 블로그">
<link rel=stylesheet href=/css/style.css media=all>
<link rel=stylesheet href=/css/syntax.css media=all>
<link rel=stylesheet href=/css/custom.css media=all>
<script src=/js/script.js></script>
<script src=/js/custom.js></script>
<script defer src=/js/fontawesome.js></script>
</head>
<body>
<header class=site-header>
<nav class=site-navi>
<h1 class=site-title>
<a href=/>
<img src=/images/profile_no_background.png>김영천 블로그 - 게을러지고 싶으면 공부해야 합니다.
</a>
</h1>
<ul class=site-navi-items>
<li class=site-navi-item-tags><a href=/tags/ title=Tags>Tags</a></li>
<li class=site-navi-item-archives><a href=/posts/ title=Archives>Archives</a></li>
<li class=site-navi-item-about><a href=/about/ title=About>About</a></li>
</ul>
</nav>
</header>
<hr class=site-header-bottom>
<div class=main role=main>
<section class="list term-list">
<article class=article>
<a href=/posts/2021-02-05-cloud-function-context-problem/ class=article-titles>
<h2 class=article-title>cloud function 호출 시 context의 중요성에 대해 알아보자.</h2>
<h3 class=article-subtitle>cloud function을 http trigger로 호출 시 context를 잘못 할당할 경우 발생하는 문제에 대해 알아봅시다.</h3>
</a>
<ul class=article-meta>
<li class=article-meta-date><time>February 5, 2021</time></li>
<li class=article-meta-tags>
<a href=/tags/gcp/>
<i class="fas fa-tag"></i>
gcp
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/cloudfunction/>
<i class="fas fa-tag"></i>
cloudfunction
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/golang/>
<i class="fas fa-tag"></i>
golang
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/context/>
<i class="fas fa-tag"></i>
context
</a>&nbsp;
</li>
</ul>
<div class=article-content>
예전 글에서 언급한 imagick-cf를 테스트 하는 도중 마주한 알 수 없는 특이한 오류와 이를 해결했던 과정을 기록합니다.
문제 url을 통해서 함수를 실행하면 최초 실행 후 일정 시간동안은 몇번을 호출하든 결과가 정상적으로 반환합니다. 하지만 이후 500 에러를 반환하기 시작합니다. 심지어 이 전에 정상적으로 반환했던 url을 그대로 호출해도 500 error를 반환하는 어처구니 없는 모습을 보여줍니다. 게다가 500 에러를 반환하는 경우엔 로그조차 남지 않아서 원인을 지레짐작으로 파악할 수 밖에 없는 상황입니다.
</div>
<div class=article-readmore><a href=/posts/2021-02-05-cloud-function-context-problem/>Read more...</a></div>
<div class=article-floatclear></div>
</article>
<article class=article>
<a href=/posts/2021-01-06-image-resize-cloud-function/ class=article-titles>
<h2 class=article-title>Cloud Functions로 실시간 이미지 리사이징 하기</h2>
<h3 class=article-subtitle>Cloud Functions을 이용해서 On-The-Fly 이미지 리사이징 및 포맷 변경을 해봅시다.</h3>
</a>
<ul class=article-meta>
<li class=article-meta-date><time>January 6, 2021</time></li>
<li class=article-meta-tags>
<a href=/tags/gcp/>
<i class="fas fa-tag"></i>
gcp
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/cloudfunctions/>
<i class="fas fa-tag"></i>
cloudfunctions
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/on-the-fly/>
<i class="fas fa-tag"></i>
on-the-fly
</a>&nbsp;
</li>
</ul>
<div class=article-content>
당근마켓, 비트윈 등에서 작성한 글을 참고하여 GCP 기반으로 비슷한 기능을 하는 코드를 작성하여 봅시다. 동작 원리는 앞서 말한 글에 자세히 나와있으니 서론은 생략하고 바로 시작합니다.
이 문서에서는 GCP의 아래 제품들을 사용합니다.
Cloud Functions
Cloud Stroage
Cloud CDN
Cloud Storage 실제 이미지들이 저장될 storage bucket을 생성해야 합니다. 여기선 특별할게 없으니 공식 가이드로 대체합니다.
Cloud Functions 코드 수정 및 배포 Cloud Function을 호출하는 방법은 여러가지가 있습니다만 이 문서에서는 http 요청을 통해 호출하는 방법을 사용합니다.
</div>
<div class=article-readmore><a href=/posts/2021-01-06-image-resize-cloud-function/>Read more...</a></div>
<div class=article-floatclear></div>
</article>
<article class=article>
<a href=/posts/2018-06-10-gae-image-api/ class=article-titles>
<h2 class=article-title>Google App Engine Image API 삽질 후기</h2>
</a>
<ul class=article-meta>
<li class=article-meta-date><time>June 10, 2018</time></li>
<li class=article-meta-tags>
<a href=/tags/gcp/>
<i class="fas fa-tag"></i>
GCP
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/gae/>
<i class="fas fa-tag"></i>
GAE
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/golang/>
<i class="fas fa-tag"></i>
golang
</a>&nbsp;
</li>
</ul>
<div class=article-content>
오늘은 GAE에서 제공하는 Image API를 사용하면서 겪은 어려움과 후기를 공유하고자 한다.
요구사항 GAE를 통해 업로드 된 이미지를 Google Cloud Storage(이하 GCS)에 보관, 파일 관련 정보를 datastore에 별도로 저장한다(업로드 한 사용자, 업로드 파일명, 업로드 날짜 등등). 이 이미지를 웹사이트를 통해 서비스를 하고싶다. 이 이미지는 사이즈가 모두 제각각인데 DSLR로 찍은 수십메가짜리 이미지부터 조그마한 썸네일 이미지까지 크기가 천차만별이다. 동일한 이미지를 여러가지 사이즈로 출력해야 한다. 가령 DSLR로 찍은 이미지를 제공할 경우 우선 100px짜리 썸네일로 제공, 사용자가 썸네일을 클릭할 경우 이미지의 원본을 보여주고 싶다.
</div>
<div class=article-readmore><a href=/posts/2018-06-10-gae-image-api/>Read more...</a></div>
<div class=article-floatclear></div>
</article>
<article class=article>
<a href=/posts/2018-05-12-datastore-projection-error/ class=article-titles>
<h2 class=article-title>datastore에서 projection query 실행 시 time.Time이 int64로 반환되는 문제 해결하기</h2>
</a>
<ul class=article-meta>
<li class=article-meta-date><time>May 12, 2018</time></li>
<li class=article-meta-tags>
<a href=/tags/gcp/>
<i class="fas fa-tag"></i>
GCP
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/gae/>
<i class="fas fa-tag"></i>
GAE
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/golang/>
<i class="fas fa-tag"></i>
golang
</a>&nbsp;
</li>
</ul>
<div class=article-content>
요구사항 datastore에 내 프로필을 방문한 사용자의 ID와 방문시간을 각각 string, time.Time 형식으로 저장하고 있다. 구조체로 보면 다음과 같다.
1 2 3 4 5 type Visitor struct { UserId string //조회한 프로필의 Id VisitorId string //방문자 Id VisitTime time.Time } 이 데이터를 단순히 조회하면 한 사용자가 나를 여러번 방문할 경우 결과 리스트에 그 방문자가 여러번 출력된다. 나는 동일한 사용자가 여러번 반복해도 가장 최근에 방문한 기록만 보길 원했다.
</div>
<div class=article-readmore><a href=/posts/2018-05-12-datastore-projection-error/>Read more...</a></div>
<div class=article-floatclear></div>
</article>
<article class=article>
<a href=/posts/2018-04-29-gae-datastore-indexes/ class=article-titles>
<h2 class=article-title>Googlde App Engine(GAE) datastore index 관련 에러 해결하기</h2>
</a>
<ul class=article-meta>
<li class=article-meta-date><time>April 29, 2018</time></li>
<li class=article-meta-tags>
<a href=/tags/gcp/>
<i class="fas fa-tag"></i>
GCP
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/gae/>
<i class="fas fa-tag"></i>
GAE
</a>&nbsp;
</li>
</ul>
<div class=article-content>
들어가며 google app engine을 이용해 REST API를 작성하던 중 발생했던 datastore의 index 관련 이슈와 그 해결법에 대해 기록한다. 참고, 여기도 참고
에러발생 상황 내 프로필을 조회한 사람들의 목록을 반환해주는 API를 작성했다. 코드는 딱히 별거 없고 그냥 datastore에 있는 데이터들을 불러오는 내용이다. 핵심코드는 아래와 같다.
1 q := datastore.NewQuery(userDao.VisitorEntity).Filter("UserId=", userId).Order("-VisitTime") UserId 필드의 값을 기준으로 필터링을 하고 VisitTime을 최근순으로 정렬하는 간단한 코드다. 위 쿼리문을 베이스로 한 API는 로컬테스트는 무사히 통과하고 배포까지 정상적으로 완료, 이 후 클라우드에 올라간 API를 테스트 했는데 다음과 같은 에러로그를 내뿜었다.
</div>
<div class=article-readmore><a href=/posts/2018-04-29-gae-datastore-indexes/>Read more...</a></div>
<div class=article-floatclear></div>
</article>
<article class=article>
<a href=/posts/2017-12-05-go-swagger-with-gae/ class=article-titles>
<h2 class=article-title>Google App Engine(GAE)에서 go swagger server 실행하기</h2>
</a>
<ul class=article-meta>
<li class=article-meta-date><time>December 5, 2017</time></li>
<li class=article-meta-tags>
<a href=/tags/go/>
<i class="fas fa-tag"></i>
go
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/swagger/>
<i class="fas fa-tag"></i>
swagger
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/gae/>
<i class="fas fa-tag"></i>
GAE
</a>&nbsp;
</li>
<li class=article-meta-tags>
<a href=/tags/gcp/>
<i class="fas fa-tag"></i>
GCP
</a>&nbsp;
</li>
</ul>
<div class=article-content>
Intro [지난번 포스트][last-post]에서 습득한 지식을 바탕으로 go-swagger를 이용해 작성한 서버를 Google App Engine(이하 GAE)에서 실행시켜보자.
spec을 이용해 서버코드 생성하기 [지난번 포스트][last-post]에서 작성한 swagger.yaml을 이용해 서버코드를 생성해보자. swagger.yaml 내용은 아래와 같다.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 swagger: "2.0" info: description: hello go swagger title: hello world application version: 1.
</div>
<div class=article-readmore><a href=/posts/2017-12-05-go-swagger-with-gae/>Read more...</a></div>
<div class=article-floatclear></div>
</article>
</section>
</div>
<div class=site-footer>
<div class=copyright>&copy; Copyright 2020 YeongCheon</div>
<ul class=site-footer-items>
<li class=site-footer-item-rsslink>
<a href=/tags/gcp/index.xml type=application/rss+xml target=_blank title=RSS>
<i class="fas fa-rss"></i>
</a>
</li>
<li class=site-footer-item-about><a href=/about/ title=About>About</a></li>
</ul>
<div class=powerdby>
Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/taikii/whiteplain>Whiteplain</a>
</div>
</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0YT8RHXZR3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-0YT8RHXZR3',{anonymize_ip:!1})}</script>
</body>
<script data-ad-client=ca-pub-4599234083355765 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
</html>